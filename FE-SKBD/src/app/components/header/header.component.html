<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand ms-5" (click)="navigateToHome()">SKBD - Shop</a>
  <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
    aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarNav">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item">
        <a class="nav-link" (click)="navigateToHome()">Home</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" routerLink="/products">Products</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" routerLink="/about">About Us</a>
      </li>
    </ul>
    <div class="search-inline my-2 my-lg-0 ">
      <app-search></app-search>
    </div>

    <ul class="navbar-nav ml-auto me-4">
      <li class="nav-item">
        <a class="nav-link" (click)="toggleLoginAside()" style="cursor: pointer;">
          <i class="fas fa-user"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" (click)="handleCartClick()" style="cursor: pointer;">
          <i class="fas fa-shopping-cart"></i>
          <span class="cart-count" *ngIf="isLoggedIn() && cartItems.length">
            {{cartItems.length}}
          </span>
        </a>
      </li>
    </ul>
  </div>
</nav>

<!-- Login Aside -->
<div class="login-aside" [class.open]="isLoginAsideOpen">
  <div class="login-aside-content">
    <button class="close-btn" (click)="closeLoginAside()">
      <i class="fas fa-times"></i>
    </button>

    <h2>Login</h2>
    <form (ngSubmit)="onLogin()">
      <div class="form-group">
        <label for="username">Username<span class="text-danger">*</span></label>
        <input type="text" id="username" class="form-control" [(ngModel)]="username" name="username" required>
      </div>

      <div class="form-group">
        <label for="password">Password<span class="text-danger">*</span></label>
        <div class="input-group">
          <input [type]="showPassword ? 'text' : 'password'" 
                 id="password" 
                 class="form-control" 
                 [(ngModel)]="password" 
                 name="password" 
                 required>
          <i [class]="showPassword ? 'fas fa-eye-slash' : 'fas fa-eye'"
             (click)="togglePasswordVisibility()"
             class="password-toggle">
          </i>
        </div>
      </div>

      <div class="form-group">
        <div class="d-flex justify-content-between align-items-center mb-3">
          <a (click)="goToForgetPass()" class="text-primary" style="cursor: pointer;">
            Forgot Password?
          </a>
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100">Login</button>
    </form>

    <div class="signup-link">
      Don't have an account?
      <a (click)="goToSignup()">Sign up</a>
    </div>
  </div>
</div>

<!-- Cart Aside -->
<div class="cart-aside" [class.open]="isCartAsideOpen">
  <div class="cart-aside-content">
    <div class="cart-header">
      <h2>Shopping Cart</h2>
      <button class="close-btn" (click)="closeCartAside()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="cart-items" *ngIf="cartItems.length > 0">
      <div class="cart-item" *ngFor="let item of cartItems">
        <img [src]="item.product.imageUrl" [alt]="item.product.nameProd">
        <div class="item-details">
          <h3>{{item.product.nameProd}}</h3>
          <div class="category">{{item.product.category.nameCat}}</div>
          <div class="price">
            ${{item.totalWithTaxe | number:'1.2-2'}}
          </div>
          <div class="quantity-controls">
            <button (click)="updateQuantity(item, -1)">-</button>
            <span>{{item.quantity}}</span>
            <button (click)="updateQuantity(item, 1)">+</button>
          </div>
        </div>
        <button class="remove-btn" (click)="removeItem(item.id)">
          <i class="fas fa-trash"></i>
        </button>
      </div>
    </div>

    <div class="empty-cart" *ngIf="cartItems.length === 0">
      <i class="fas fa-shopping-cart"></i>
      <p>Your cart is empty</p>
    </div>

    <div class="cart-footer" *ngIf="cartItems.length > 0">
      <div class="total">
        <span>Total:</span>
        <span>${{getTotalPrice() | number:'1.2-2'}}</span>
      </div>
      <button class="checkout-btn" (click)="proceedToCheckout()">
        Proceed to Checkout
      </button>
    </div>
  </div>
</div>

<!-- Overlay -->
<div class="aside-overlay" [class.active]="isCartAsideOpen" (click)="closeCartAside()">
</div>